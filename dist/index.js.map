{"version":3,"sources":["../src/index.tsx"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import React, { ReactNode } from \"react\";\nimport axios, { AxiosError } from \"axios\";\nimport StackTrace from \"sourcemapped-stacktrace\";\nimport { ErrorAlertProps } from \"./ErrorAlert\";\nexport { default as ErrorAlert } from \"./ErrorAlert\";\nlet windowOnerrorTimeout: NodeJS.Timeout | number | null;\nlet windowOnerrorReference: ReactError;\n\nexport type ErrorReportConfig = {\n  disable_slack_posting: boolean;\n  header: string | null;\n  max_network_request_data: number;\n  override_window_onerror: boolean;\n  slack_webhook: string | null;\n};\nexport type ErrorStatus = \"detected\" | \"sent\" | \"failed\";\nexport interface OnErrorCBResponse {\n  prefix?: string;\n  custom_error_props?: ErrorAlertProps;\n}\n\nexport interface ERProps {\n  children: ReactNode;\n  ErrorAlert: React.ComponentType<ErrorAlertProps> | null;\n  callback?: () => OnErrorCBResponse | null;\n}\nexport interface ERState {\n  hasError: boolean;\n  status: ErrorStatus | null;\n  custom_props: { [key: string]: any };\n}\nexport interface ExtendedError extends Partial<AxiosError> {\n  network_error?: boolean;\n  additional_message?: string;\n  timestamp?: Date;\n}\ninterface ReactError extends ExtendedError {\n  component_trace?: string;\n  stack?: any;\n}\n\nlet config: ErrorReportConfig = {\n  disable_slack_posting: false,\n  header: null,\n  max_network_request_data: 400,\n  override_window_onerror: false,\n  slack_webhook: null\n};\n\nlet error: ReactError | null = null;\nlet errorStatus: ErrorStatus | null = null;\nconst listeners: ((status: ErrorStatus) => string | null)[] = [];\n\n//\n//\n/////////////////////\n//POSTING FUNCTIONS\n\nfunction postToSlack(msg: string): Promise<void> {\n  const postStack = new Error().stack;\n  return new Promise((resolve, reject) => {\n    if (!config.slack_webhook) {\n      const err = new Error(\n        \"ErrReporting: Property 'slack_webhook' not specified in config.\"\n      );\n      err.stack = postStack;\n      console.error(err);\n      reject(err);\n      return;\n    }\n    if (config.disable_slack_posting) {\n      console.log(\n        \"ErrReporting: Not sent because of disable_slack_posting flag!\"\n      );\n      resolve();\n      return;\n    }\n\n    const payload = encodeURIComponent(JSON.stringify({ text: msg }));\n\n    axios({\n      url: config.slack_webhook,\n      headers: {\n        \"content-type\": \"application/x-www-form-urlencoded\"\n      },\n      method: \"POST\",\n      data: \"payload=\" + payload\n    })\n      .then(() => {\n        console.log(\"ErrReporting: Successfully posted to slack.\");\n        resolve();\n      })\n      .catch(err => {\n        console.error(\"ErrReporting: Failed to post to slack.\");\n        reject(err);\n      });\n  });\n}\n\nexport function sendDebug(msg: string | string[]): void {\n  if (Array.isArray(msg)) {\n    postToSlack(msg.join(\"\\n\"));\n  } else {\n    postToSlack(msg);\n  }\n}\n///////////////////////////////\n///////////////////////////////\n///////////////////////////////\n///////////////////////////////\n///////////////////////////////\n///////////////////////////////\n//MESSAGE COMPOSITION FUNCTIONS\n\nfunction composeNetworkErrMessage(err: ReactError): string {\n  let msg = \"NETWORK ERROR: at \";\n  if (err.timestamp) {\n    msg += err.timestamp.toISOString();\n  } else {\n    msg += new Date().toISOString();\n  }\n  msg += \" \";\n  let cfg = \"\";\n  if (err.config) {\n    cfg = \"URL: \" + err.config.url + \", \" + err.config.method;\n    cfg +=\n      err.config.headers && err.config.headers.Authorization\n        ? \" (Auth header sent)\\n\"\n        : \"(NO Auth header)\\n\";\n    if (err.config.data) {\n      cfg +=\n        //NOTE: JSON.stringify() is NOT guaranteed to return a string, when passing in undefined it returns typeof undefined!\n        \"DATA SENT: '\" +\n        (JSON.stringify(err.config.data) + \"\").substr(\n          0,\n          config.max_network_request_data\n        ) +\n        \"'\\n\";\n    } else {\n      cfg += \"NO DATA SENT\";\n    }\n  } else {\n    cfg = \"NO NETWORK REQUEST axios CONFIG FOUND.\";\n  }\n\n  if (err.response) {\n    let data = JSON.stringify(err.response.data);\n    if (!data) {\n      data = \"''\";\n    } else {\n      data = \"'\" + data + \"'\";\n    }\n    let headers = JSON.stringify(err.response.headers);\n    if (!headers) {\n      headers = \"''\";\n    } else {\n      headers = \"'\" + headers + \"'\";\n    }\n    msg += \"\\nResponse data: \" + data;\n    msg += \"\\nResponse status: \" + err.response.status;\n    msg += \"\\nResponse headers: \" + headers;\n    msg += \"\\n\" + cfg;\n  } else if (err.request) {\n    msg += \"Probably OPTIONS failed! No response was given.\";\n    msg += \"\\n\" + cfg;\n  } else {\n    msg +=\n      \"Unknown error; response and request data undefined. NO HTTP STATUS CODE :(\";\n    msg += \"\\n\" + cfg;\n  }\n  return msg;\n}\n\nfunction composeErrMessage(err: ReactError): string {\n  let msg = \"NETWORK ERROR: at \";\n  if (err.timestamp) {\n    msg += err.timestamp.toISOString();\n  } else {\n    msg += new Date().toISOString();\n  }\n  msg += \" \";\n  return msg;\n}\n\nfunction resolveStack(err: ReactError): Promise<string[]> {\n  return new Promise(resolve => {\n    if (err.stack) {\n      StackTrace.mapStackTrace(err.stack, resolvedTrace => {\n        resolve(resolvedTrace);\n      });\n    } else {\n      resolve([\"NO STACK IN ERROR OBJECT\"]);\n    }\n  });\n}\n\nfunction composeMessage(\n  err: ReactError,\n  prefix: string | null = null\n): Promise<string> {\n  let head = config.header || \"\";\n  head +=\n    location.protocol +\n    location.hostname +\n    \" '\" +\n    location.pathname +\n    \"'\" +\n    \"\\n\";\n  head += \"Created at \" + new Date().toISOString() + \"\\n\";\n  if (prefix) {\n    head += prefix;\n  }\n  head += \"\\nERROR: \" + err.message + \"\\n\";\n  if (err.additional_message) {\n    head += err.additional_message + \"\\n\";\n  }\n\n  const body = err.network_error\n    ? composeNetworkErrMessage(err)\n    : composeErrMessage(err);\n\n  let trace = \"\";\n  if (err.component_trace) {\n    trace += err.component_trace + \"\\n---------\\n\";\n  }\n  return resolveStack(err).then(resolvedStack => {\n    if (Array.isArray(resolvedStack)) {\n      trace += resolvedStack.join(\"\\n\");\n    }\n    return head + \"\\n\" + body + \"\\n\" + trace;\n  });\n}\n\n//END OF MESSAGE COMPOSITION\n//\n//\n//\n//\n\nfunction setStatus(status: ErrorStatus): string {\n  errorStatus = status;\n  let prefixes = \"\";\n\n  listeners.forEach(listenerCB => {\n    const prefix = listenerCB(status);\n    if (prefix) {\n      prefixes += prefix;\n    }\n  });\n\n  return prefixes;\n}\n\n/**\n * Add property `network_error: true` to the error object to signal to the error reporter that it should\n * look for network related properties and network request data.\n * Use property `additional_message: <string>` on the error object to add additional data to the error report.\n */\nexport function setError(err: ExtendedError): void {\n  if (windowOnerrorReference === err) {\n    //If window.onerror has already caught this error we clear its timeout\n    //and handle it in this subsequent error catch.\n    if (windowOnerrorTimeout) {\n      clearTimeout(windowOnerrorTimeout as NodeJS.Timeout);\n    }\n  }\n  if (axios.isCancel(err)) {\n    //This is true when we have manually cancelled a network request.\n    return;\n  }\n  error = err;\n  const prefix = setStatus(\"detected\");\n  composeMessage(err, prefix)\n    .then(msg => {\n      console.log(\"Error report generated:\", msg);\n      return postToSlack(msg);\n    })\n    .then(() => {\n      setStatus(\"sent\");\n    })\n    .catch(() => {\n      setStatus(\"failed\");\n    });\n}\n\n////////////////\n////////////////\n////////////////\n////////////////\n//INITIAL ERROR LISTENER ATTACHING\n\nconst onerrorListener = (\n  message: Event | string,\n  source?: string,\n  lineno?: number,\n  colno?: number,\n  err?: ExtendedError\n): boolean => {\n  if (!err) {\n    if (typeof message === \"string\") {\n      err = new Error(\"ONLY STRING PROVIDED: \" + message);\n    } else {\n      err = new Error(\"INVALID CALL TO window.onerror. CANNOT RESOLVE.\");\n    }\n  }\n  windowOnerrorTimeout = setTimeout(() => {\n    //This timeout is here because shortly after window.onerror the React Error Boundary will\n    //trigger if the error was caused inside a React Component life cycle.\n    //The Error Boundary has more information and will cancel this timeout to ensure we do\n    //not post the same error report twice.\n    windowOnerrorTimeout = null;\n    if (err) {\n      if (!err.additional_message) {\n        err.additional_message = \"CAUGHT BY WINDOW.ONERROR.\";\n      } else {\n        err.additional_message += \" CAUGHT BY WINDOW.ONERROR.\";\n      }\n      setError(err);\n    }\n  }, 500);\n  windowOnerrorReference = err;\n  return true;\n};\n\nif (!window.onerror) {\n  window.onerror = onerrorListener;\n  console.log(\"ErrReporting: Listening to window.onerror\");\n} else if (window.onerror !== onerrorListener) {\n  console.log(\n    \"ErrReporting: window.onerror already assigned. Use setConfig({ override_window_onerror: true }) to override.\"\n  );\n}\n\n////////////////\n////////////////\n////////////////\n////////////////\n\nexport function setHeader(headerString: string): void {\n  config.header = headerString;\n}\n\nexport function setConfig(configObj: Partial<ErrorReportConfig>): void {\n  config = Object.assign({}, config, configObj);\n  if (config.override_window_onerror) {\n    window.onerror = onerrorListener;\n  }\n}\n\nexport function getConfig(): ErrorReportConfig {\n  return Object.assign({}, config);\n}\n\nexport function getError(): ReactError | null {\n  return error;\n}\n\nexport function getStatus(): ErrorStatus | null {\n  return errorStatus;\n}\n\n//\n//\nexport class ErrorReporting extends React.Component<ERProps, ERState> {\n  constructor(props: ERProps) {\n    super(props);\n\n    this.state = {\n      hasError: false,\n      status: null,\n      custom_props: {}\n    };\n  }\n\n  componentWillMount(): void {\n    listeners.push(status => {\n      return this.errorListener(status);\n    });\n  }\n\n  errorListener(status: ErrorStatus): string | null {\n    //This is to ensure component will re-render when the status of error changes.\n\n    let prefix: string | null = null;\n    let custom_props: { [key: string]: any } = {};\n    if (this.props.callback) {\n      const CBReturn = this.props.callback();\n      if (CBReturn) {\n        prefix = CBReturn.prefix ? CBReturn.prefix : null;\n        custom_props = CBReturn.custom_error_props\n          ? CBReturn.custom_error_props\n          : {};\n      }\n    }\n    this.setState({\n      hasError: true,\n      status: status,\n      custom_props: custom_props\n    });\n    return prefix;\n  }\n\n  componentDidCatch(err: ReactError, info: React.ErrorInfo): void {\n    this.setState({\n      hasError: true\n    });\n\n    err.component_trace = info.componentStack;\n    setError(err);\n  }\n\n  componentWillUnmount(): void {\n    //Remove listener callback so that we don't get called after we're removed or are kept in memory for no reason.\n    const listenerIndex = listeners.findIndex(\n      listener => listener === this.errorListener\n    );\n    if (listenerIndex > -1) {\n      listeners.splice(listenerIndex, 1);\n    }\n  }\n\n  render(): ReactNode {\n    const EA = this.props.ErrorAlert;\n    if (this.state.hasError && EA) {\n      return (\n        <EA status={getStatus()} custom_error_props={this.state.custom_props} />\n      );\n    } else if (this.state.hasError && EA === null) {\n      return null;\n    }\n\n    return this.props.children;\n  }\n}\n"]}